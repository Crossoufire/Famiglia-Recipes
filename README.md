# Famiglia Recipes

A simple and modern web application for families to share and manage their favorite recipes.
This app is built with a focus on simplicity and ease of use.

---

## Features

- **Full Recipe CRUD:** Create, read, update, and delete recipes.
- **Authentication:** Secure user registration (register-key), login, and password reset.
- **Recipe Discovery:** Search recipes by title or filter them using labels.
- **Interactive UI:**
    - Dashboard to quickly see your favorite / latest recipes.
    - Dynamic ingredient scaling based on the number of servings.
- **Community Features:** Add recipes to your favorites and comment on them.
- **Multilingual Support:** Switch between English and French.
- **Admin & Maintenance:**
    - In prod, critical server errors automatically trigger an email to the site administrator.

---

## Tech Stack

- **Backend:** Node.js
- **Framework:** [TanStack Start](https://tanstack.com/start/v0)
- **Frontend:** [React](https://react.dev/), [TanStack Router](https://tanstack.com/router/latest), [TanStack Query](https://tanstack.com/query/latest)
- **Database:** [Drizzle ORM](https://orm.drizzle.team/) with [Turso](https://turso.tech/) (libSQL)
- **UI:** [Tailwind CSS](https://tailwindcss.com/) & [shadcn/ui](https://ui.shadcn.com/)
- **Authentication:** [Better-Auth](https://github.com/GentikSolm/better-auth)
- **Validation:** [Zod 4](https://zod.dev/)
- **i18n:** [i18next](https://www.i18next.com/)

---

## Getting Started

Follow these instructions to get a copy of the project up and running on your local machine.

### Prerequisites

- Node.js (v20 or higher)
- npm or your favorite package manager

### Installation

1. **Clone the repository:**
   ```bash
   git clone https://github.com/Crossoufire/Famiglia-Recipes.git
   cd Famiglia-Recipes
   ```

2. **Install dependencies:**
   ```bash
   npm install
   ```

3. **Set up environment variables:**
    - Create a `.env` file in the root of the project by copying the example file:
      ```bash
      cp .env.example .env
      ```
    - Fill in the required variables in the `.env` file. See the section below for details.

4. **Generate a registration key:**
   The application uses a _secret key_ for new user registrations. Run the following script to generate a new key and hash, then add them to your `.env` file.
   ```bash
   node src/lib/server/utils/hash-key.ts
   ```

5. **Run the development server:**
   ```bash
   npm run dev
   ```
   The application will be available at `http://localhost:3000`.

---

## Env Variables

Your `.env` file should contain the following variables:

```env
# SQlite/libSQL database connection URL
DATABASE_URL="file:./instance/site.db"

# Base URL for application
VITE_BASE_URL="http://localhost:3000"

# Path to uploads images
IMAGE_UPLOADS_PATH="./public/static/recipe-images"

# Secret for session encryption (use a long random string)
BETTER_AUTH_SECRET="your_strong_secret_here"

# Credentials for sending emails (e.g., Gmail)
MAIL_USERNAME="your-email@gmail.com"
MAIL_PASSWORD="your-gmail-app-password"

# The key for private website
REGISTER_KEY=<your_register_key>

# Generated by `hash-key.ts` script
REGISTER_KEY_SALT=...
REGISTER_KEY_HASH=...
```

---

## Production Configuration

There are two critical path configurations that must be kept in sync between the `Node.js` app and `Nginx` reverse proxy:

1. **Upload URL Path:**
    - **Nginx:** `location /uploads/recipe-images/` in the `nginx.conf`.
    - **Application:** The URL string in `imageUrl` located in `src/lib/server/database/custom-types.ts`.

2. **Upload Filesystem Path:**
    - **Nginx:** `alias` path in `nginx.conf`
    - **Application:** `IMAGE_UPLOADS_PATH` in the production `.env` file
